# 紧急修复：工具输入类型错误

## 问题描述

用户运行 Agent 时立即遇到错误：
```
❌ 错误: 'str' object has no attribute 'get'
```

## 根因分析

1. **IncrementalOutputFormatter** 的 `format_tool_call` 方法期望 `tool_input` 参数是字典类型
2. 但是根据 `src/entities.py` 中的定义，`ToolUseContent.input` 可以是 `str | dict[str, Any]`
3. 当 Agent 接收到字符串类型的工具输入时，尝试调用 `.get()` 方法会失败

## 修复方案

在 `src/incremental_output_formatter.py` 的 `format_tool_call` 方法开始处添加类型检查：

```python
def format_tool_call(self, tool_name: str, tool_input: Dict[str, Any]) -> Optional[str]:
    """格式化工具调用输出 - 只显示新的调用"""
    
    # 确保 tool_input 是字典类型
    if not isinstance(tool_input, dict):
        tool_input = {"input": str(tool_input)}
    
    # 后续代码保持不变...
```

## 测试验证

1. 创建了测试脚本验证修复有效
2. 运行主程序确认错误已解决
3. Agent 现在可以正常处理字符串和字典类型的工具输入

## 经验教训

- 在处理外部输入时，始终要进行类型检查
- 查看接口定义，了解可能的数据类型
- 添加防御性编程，提高代码健壮性