# 使用 Agent 开发 Dify 插件

## 概述

本 Agent 已配置用于开发 Dify 工具插件。`agent_root` 目录下包含了完整的开发资源。

## 可用资源

### 1. 参考文档 (`storage/documents/plugins/`)

- **快速入门**：插件开发的基础教程
- **模式定义**：插件结构和 API 定义
- **最佳实践**：开发建议和注意事项
- **发布指南**：如何发布到 Dify 市场

### 2. 代码示例 (`storage/few_shots/`)

#### Google Calendar 插件
- 创建日程：`create_event.py`
- 搜索日程：`search_events.py`
- 列出日历：`list_calendars.py`
- 列出事件：`list_events.py`

#### HackerNews 插件
- 获取热门故事：`get_top_stories.py`
- 获取用户信息：`get_user_info.py`
- 获取故事详情：`get_story_info.py`

#### SQLite 插件
- 数据库操作：增删改查示例
- JSON 数据处理
- 表结构管理

### 3. 工作空间 (`workspace/`)

Agent 会在这里创建和开发新的插件项目。

## 开发流程

### 1. 告诉 Agent 你的需求

```
我想开发一个 XXX 功能的 Dify 工具插件，它应该能够...
```

### 2. Agent 会自动：

1. **分析需求**：理解插件功能
2. **查阅文档**：参考开发规范
3. **参考示例**：学习类似实现
4. **创建项目**：在 workspace 中初始化
5. **编写代码**：实现插件功能
6. **测试调试**：确保功能正常

### 3. 查看进度

- 查看 `context_window_main.md` 了解 Agent 当前状态
- 查看 `workspace/` 中的项目文件
- 查看 `logs/` 了解 Agent 的操作历史

## 典型对话示例

### 创建新插件

```
用户：我需要一个天气查询的 Dify 工具插件，支持查询指定城市的天气

Agent：我来帮您开发一个天气查询的 Dify 工具插件。让我先查看文档了解插件结构...
[Agent 开始工作]
```

### 修改现有插件

```
用户：帮我给 workspace 中的天气插件添加一个查询未来 7 天天气的功能

Agent：我来查看现有的天气插件代码，并添加 7 天天气预报功能...
[Agent 开始修改]
```

### 测试插件

```
用户：测试一下刚才开发的插件是否能正常工作

Agent：我来编写测试用例并运行测试...
[Agent 执行测试]
```

## 注意事项

1. **API 密钥**：如果插件需要外部 API，请提供必要的配置信息
2. **依赖管理**：Agent 会使用 `uv` 管理 Python 依赖
3. **代码规范**：Agent 会遵循 Dify 插件开发规范
4. **错误处理**：Agent 会实现适当的错误处理机制

## 插件发布

开发完成后，Agent 可以：

1. 生成插件包
2. 准备发布文档
3. 提供发布指导

但实际发布到 Dify 市场需要您手动完成。

## 常见问题

### Q: Agent 能开发哪些类型的插件？

A: Agent 可以开发各种工具类插件，包括但不限于：
- API 集成（天气、翻译、搜索等）
- 数据处理（格式转换、数据分析等）
- 文件操作（读写、转换等）
- 系统工具（执行命令、环境检查等）

### Q: 如何提供 API 密钥等敏感信息？

A: 建议：
1. 创建 `.env` 文件（Agent 会自动忽略）
2. 或在代码中使用占位符，后续手动替换

### Q: Agent 会自动测试插件吗？

A: 是的，Agent 会：
1. 编写基本的单元测试
2. 创建使用示例
3. 进行基础功能验证

但建议您在实际环境中进行完整测试。

### Q: 如何让 Agent 参考特定的示例？

A: 您可以：
1. 明确指出："参考 Google Calendar 插件的实现方式"
2. 提供具体文件路径："查看 storage/few_shots/google_calendar/tools/create_event.py"

## 开始使用

1. 启动 Agent：`uv run python main.py`
2. 描述您的插件需求
3. Agent 开始工作
4. 查看成果并提供反馈

祝您开发顺利！